(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const G=e=>{e.remove()},Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),M=(e,{userId:t,onPreviewPicture:o,onLikeIcon:c,onDeleteCard:r})=>{const n=Q(),a=n.querySelector(".card__like-button"),h=n.querySelector(".card__control-button_type_delete"),l=n.querySelector(".card__image"),i=n.querySelector(".card__like-count");return l.src=e.link,l.alt=e.name,n.querySelector(".card__title").textContent=e.name,i&&(i.textContent=e.likes.length),e.likes.some(k=>k._id===t)&&a.classList.add("card__like-button_is-active"),e.owner._id!==t?h.remove():r&&h.addEventListener("click",()=>r(n,e._id)),c&&a.addEventListener("click",()=>{const k=a.classList.contains("card__like-button_is-active");c(a,e._id,k,i)}),o&&l.addEventListener("click",()=>o({name:e.name,link:e.link})),n},N=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",N)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",N)},X=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},Y=(e,t,o,c)=>{const r=e.querySelector(`#${t.id}-error`);r.textContent=o,t.classList.add(c.inputErrorClass),r.classList.add(c.errorClass),D(e,c)},$=(e,t,o)=>{const c=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),c.classList.remove(o.errorClass),c.textContent="",F(e,o)},Z=(e,t,o)=>{if(t.validity.valid)$(e,t,o);else{const c=t.validity.patternMismatch?t.dataset.errorMessage:t.validationMessage;Y(e,t,c,o)}},ee=(e,t)=>Array.from(e.querySelectorAll(t.inputSelector)).some(o=>!o.validity.valid),D=(e,t)=>{const o=e.querySelector(t.submitButtonSelector);o.disabled=!0,o.classList.add(t.inactiveButtonClass)},F=(e,t)=>{const o=e.querySelector(t.submitButtonSelector);o.disabled=!1,o.classList.remove(t.inactiveButtonClass)},O=(e,t)=>{ee(e,t)?D(e,t):F(e,t)},te=(e,t)=>{Array.from(e.querySelectorAll(t.inputSelector)).forEach(o=>{o.addEventListener("input",()=>{Z(e,o,t),O(e,t)})})},E=(e,t)=>{Array.from(e.querySelectorAll(t.inputSelector)).forEach(o=>$(e,o,t)),O(e,t)},oe=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(t=>te(t,e))},s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"2a1af7f5-79f3-449d-a11e-9d963bd534cd","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),re=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(d),W=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(d),ne=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(d),ce=({avatar:e})=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(d),se=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(d),ae=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(d),le=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(d),q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};oe(q);const H=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),L=v.querySelector(".popup__form"),j=L.querySelector(".popup__input_type_name"),J=L.querySelector(".popup__input_type_description"),b=document.querySelector(".popup_type_new-card"),f=b.querySelector(".popup__form"),ie=f.querySelector(".popup__input_type_card-name"),ue=f.querySelector(".popup__input_type_url"),B=document.querySelector(".popup_type_image"),P=B.querySelector(".popup__image"),de=B.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),me=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),U=document.querySelector(".profile__image"),C=document.querySelector(".popup_type_edit-avatar"),g=C.querySelector(".popup__form"),_e=g.querySelector(".popup__input"),w=document.querySelector(".popup_type_remove-card"),V=w.querySelector(".popup__button"),y=document.querySelector(".popup_type_info"),fe=y.querySelector(".popup__title"),m=y.querySelector(".popup__info"),ye=y.querySelector(".popup__text"),A=y.querySelector(".popup__list"),he=document.getElementById("popup-info-definition-template"),Se=document.getElementById("popup-info-user-preview-template"),ve=document.querySelector(".header__logo");let x,_=null;const z=({name:e,link:t})=>{P.src=t,P.alt=e,de.textContent=e,p(B)},be=e=>{e.preventDefault();const t=L.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0;const c=j.value,r=J.value;ne({name:c,about:r}).then(n=>{I.textContent=n.name,T.textContent=n.about,u(v)}).catch(n=>{console.error("Ошибка при обновлении профиля:",n)}).finally(()=>{t.textContent=o,t.disabled=!1})},Ce=e=>{e.preventDefault();const t=g.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0;const c=_e.value;ce({avatar:c}).then(r=>{U.style.backgroundImage=`url(${r.avatar})`,u(C)}).catch(r=>{console.error("Ошибка при обновлении аватара:",r)}).finally(()=>{t.textContent=o,t.disabled=!1})},qe=e=>{e.preventDefault();const t=f.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",t.disabled=!0;const c=ie.value,r=ue.value;se({name:c,link:r}).then(n=>{H.prepend(M(n,{userId:x,onPreviewPicture:z,onLikeIcon:R,onDeleteCard:K})),u(b)}).catch(n=>{console.error("Ошибка при добавлении карточки:",n)}).finally(()=>{t.textContent=o,t.disabled=!1})},K=(e,t)=>{_={cardElement:e,cardId:t},p(w)},Le=()=>{if(!_)return;const e=V,t=e.textContent;e.textContent="Удаление...",e.disabled=!0,ae(_.cardId).then(()=>{G(_.cardElement),u(w)}).catch(o=>{console.error("Ошибка при удалении карточки:",o)}).finally(()=>{e.textContent=t,e.disabled=!1,_=null})},R=(e,t,o,c)=>{le(t,o).then(r=>{e.classList.toggle("card__like-button_is-active"),c&&(c.textContent=r.likes.length)}).catch(r=>{console.error("Ошибка при обновлении лайка:",r)})},S=(e,t)=>{const o=he.content.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},ge=e=>{const t=Se.content.cloneNode(!0);return t.querySelector(".popup__list-item").textContent=e,t},ke=()=>{m.innerHTML="",A.innerHTML="",fe.textContent="Статистика карточек",W().then(e=>{const t=[];for(const l of e){const i=l.owner.name;t.includes(i)||t.push(i)}const o=t.length;let c=0,r=0;const n=[];let a=null;for(const l of e){const i=l.likes.length;c+=i,i>r?(r=i,n.length=0,n.push(l.name),a=l):i===r&&n.push(l.name)}const h=a?a.owner.name:"—";m.append(S("Всего пользователей:",o)),m.append(S("Всего лайков:",c)),m.append(S("Максимально лайков от одного:",r)),m.append(S("Чемпион лайков:",h)),ye.textContent="Популярные карточки:",n.forEach(l=>{A.append(ge(l))}),p(y)}).catch(e=>{console.error("Ошибка при загрузке статистики:",e)})};L.addEventListener("submit",be);f.addEventListener("submit",qe);g.addEventListener("submit",Ce);pe.addEventListener("click",()=>{j.value=I.textContent,J.value=T.textContent,p(v),E(v,q)});U.addEventListener("click",()=>{g.reset(),p(C),E(C,q)});me.addEventListener("click",()=>{f.reset(),p(b),E(b,q)});V.addEventListener("click",Le);ve.addEventListener("click",ke);const xe=document.querySelectorAll(".popup");xe.forEach(e=>{X(e)});Promise.all([W(),re()]).then(([e,t])=>{x=t._id,I.textContent=t.name,T.textContent=t.about,U.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{H.append(M(o,{userId:x,onPreviewPicture:z,onLikeIcon:R,onDeleteCard:K}))})}).catch(e=>{console.error("Ошибка при загрузке данных:",e)});
