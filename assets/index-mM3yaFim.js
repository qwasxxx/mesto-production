(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const R=e=>{e.remove()},G=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),A=(e,{userId:t,onPreviewPicture:o,onLikeIcon:c,onDeleteCard:r})=>{const n=G(),a=n.querySelector(".card__like-button"),h=n.querySelector(".card__control-button_type_delete"),l=n.querySelector(".card__image"),i=n.querySelector(".card__like-count");return l.src=e.link,l.alt=e.name,n.querySelector(".card__title").textContent=e.name,i&&(i.textContent=e.likes.length),e.likes.some(k=>k._id===t)&&a.classList.add("card__like-button_is-active"),e.owner._id!==t?h.remove():r&&h.addEventListener("click",()=>r(n,e._id)),c&&a.addEventListener("click",()=>{const k=a.classList.contains("card__like-button_is-active");c(a,e._id,k,i)}),o&&l.addEventListener("click",()=>o({name:e.name,link:e.link})),n},M=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",M)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",M)},Q=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},X=(e,t,o,c)=>{const r=e.querySelector(`#${t.id}-error`);r.textContent=o,t.classList.add(c.inputErrorClass),r.classList.add(c.errorClass),$(e,c)},N=(e,t,o)=>{const c=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),c.classList.remove(o.errorClass),c.textContent="",D(e,o)},Y=(e,t,o)=>{if(t.validity.valid)N(e,t,o);else{const c=t.validity.patternMismatch?t.dataset.errorMessage:t.validationMessage;X(e,t,c,o)}},Z=(e,t)=>Array.from(e.querySelectorAll(t.inputSelector)).some(o=>!o.validity.valid),$=(e,t)=>{const o=e.querySelector(t.submitButtonSelector);o.disabled=!0,o.classList.add(t.inactiveButtonClass)},D=(e,t)=>{const o=e.querySelector(t.submitButtonSelector);o.disabled=!1,o.classList.remove(t.inactiveButtonClass)},F=(e,t)=>{Z(e,t)?$(e,t):D(e,t)},ee=(e,t)=>{Array.from(e.querySelectorAll(t.inputSelector)).forEach(o=>{o.addEventListener("input",()=>{Y(e,o,t),F(e,t)})})},x=(e,t)=>{Array.from(e.querySelectorAll(t.inputSelector)).forEach(o=>N(e,o,t)),F(e,t)},te=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(t=>ee(t,e))},s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"2a1af7f5-79f3-449d-a11e-9d963bd534cd","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),oe=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(d),O=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(d),re=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(d),ne=({avatar:e})=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(d),ce=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(d),se=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(d),ae=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(d),q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};te(q);const W=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),L=v.querySelector(".popup__form"),H=L.querySelector(".popup__input_type_name"),j=L.querySelector(".popup__input_type_description"),b=document.querySelector(".popup_type_new-card"),f=b.querySelector(".popup__form"),le=f.querySelector(".popup__input_type_card-name"),ie=f.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),U=E.querySelector(".popup__image"),ue=E.querySelector(".popup__caption"),de=document.querySelector(".profile__edit-button"),pe=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),T=document.querySelector(".profile__image"),C=document.querySelector(".popup_type_edit-avatar"),g=C.querySelector(".popup__form"),me=g.querySelector(".popup__input"),w=document.querySelector(".popup_type_remove-card"),J=w.querySelector(".popup__button"),y=document.querySelector(".popup_type_info"),_e=y.querySelector(".popup__title"),m=y.querySelector(".popup__info"),fe=y.querySelector(".popup__text"),P=y.querySelector(".popup__list"),ye=document.getElementById("popup-info-definition-template"),he=document.getElementById("popup-info-user-preview-template"),Se=document.querySelector(".header__logo");let _=null;const V=({name:e,link:t})=>{U.src=t,U.alt=e,ue.textContent=e,p(E)},ve=e=>{e.preventDefault();const t=L.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0;const c=H.value,r=j.value;re({name:c,about:r}).then(n=>{B.textContent=n.name,I.textContent=n.about,u(v)}).catch(n=>{console.error("Ошибка при обновлении профиля:",n)}).finally(()=>{t.textContent=o,t.disabled=!1})},be=e=>{e.preventDefault();const t=g.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0;const c=me.value;ne({avatar:c}).then(r=>{T.style.backgroundImage=`url(${r.avatar})`,u(C)}).catch(r=>{console.error("Ошибка при обновлении аватара:",r)}).finally(()=>{t.textContent=o,t.disabled=!1})},Ce=e=>{e.preventDefault();const t=f.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",t.disabled=!0;const c=le.value,r=ie.value;ce({name:c,link:r}).then(n=>{W.prepend(A(n,{onPreviewPicture:V,onLikeIcon:K,onDeleteCard:z})),u(b)}).catch(n=>{console.error("Ошибка при добавлении карточки:",n)}).finally(()=>{t.textContent=o,t.disabled=!1})},z=(e,t)=>{_={cardElement:e,cardId:t},p(w)},qe=()=>{if(!_)return;const e=J,t=e.textContent;e.textContent="Удаление...",e.disabled=!0,se(_.cardId).then(()=>{R(_.cardElement),u(w)}).catch(o=>{console.error("Ошибка при удалении карточки:",o)}).finally(()=>{e.textContent=t,e.disabled=!1,_=null})},K=(e,t,o,c)=>{ae(t,o).then(r=>{e.classList.toggle("card__like-button_is-active"),c&&(c.textContent=r.likes.length)}).catch(r=>{console.error("Ошибка при обновлении лайка:",r)})},S=(e,t)=>{const o=ye.content.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Le=e=>{const t=he.content.cloneNode(!0);return t.querySelector(".popup__list-item").textContent=e,t},ge=()=>{m.innerHTML="",P.innerHTML="",_e.textContent="Статистика карточек",O().then(e=>{const t=[];for(const l of e){const i=l.owner.name;t.includes(i)||t.push(i)}const o=t.length;let c=0,r=0;const n=[];let a=null;for(const l of e){const i=l.likes.length;c+=i,i>r?(r=i,n.length=0,n.push(l.name),a=l):i===r&&n.push(l.name)}const h=a?a.owner.name:"—";m.append(S("Всего пользователей:",o)),m.append(S("Всего лайков:",c)),m.append(S("Максимально лайков от одного:",r)),m.append(S("Чемпион лайков:",h)),fe.textContent="Популярные карточки:",n.forEach(l=>{P.append(Le(l))}),p(y)}).catch(e=>{console.error("Ошибка при загрузке статистики:",e)})};L.addEventListener("submit",ve);f.addEventListener("submit",Ce);g.addEventListener("submit",be);de.addEventListener("click",()=>{H.value=B.textContent,j.value=I.textContent,p(v),x(v,q)});T.addEventListener("click",()=>{g.reset(),p(C),x(C,q)});pe.addEventListener("click",()=>{f.reset(),p(b),x(b,q)});J.addEventListener("click",qe);Se.addEventListener("click",ge);const ke=document.querySelectorAll(".popup");ke.forEach(e=>{Q(e)});Promise.all([O(),oe()]).then(([e,t])=>{B.textContent=t.name,I.textContent=t.about,T.style.backgroundImage=`url(${t.avatar})`;const o=t._id;e.forEach(c=>{W.append(A(c,{userId:o,onPreviewPicture:V,onLikeIcon:K,onDeleteCard:z}))})}).catch(e=>{console.error("Ошибка при загрузке данных:",e)});
